addEventListener("load",()=>{Vue.component("become-form",{props:{formData:{type:Object,default:()=>{}}},data(){const e=function(e,t,o){var r=/^(0\d{2,3})-?(\d{7,8})$/,m=/^1(\d{10})$/;r.test(t)||m.test(t)?o():o(new Error("请填写正确的号码"))};return{becomeRules:{name:[{required:!0,trigger:"blur",message:"请填写姓名"}],phone:[{required:!0,trigger:"blur",message:"请填写电话号码"},{trigger:"blur",validator:e}]},initBecomeType:[],hasExtra:{},initBecomeForm:{name:"",phone:"",companyName:"",type:22,typeName:"",dealerBrand:"",enterpriseType:1},becomeForm:{},loading:!1}},watch:{"becomeForm.enterpriseType":{handler(e,t){2===e?(this.initBecomeForm.type=20,this.becomeForm.type=20):1===e&&(this.initBecomeForm.type=22,this.becomeForm.type=22)},immediate:!0}},computed:{becomeType(){return this.initBecomeType.filter(e=>(2!==this.becomeForm.enterpriseType||22!==e.id)&&e)}},created(){this.init()},methods:{init(e){e&&"[object Object]"===Object.prototype.toString.call(e)?this.becomeForm=Object.assign({},this.initBecomeForm,e):this.initData()},initData(){this.becomeForm=Object.assign({},this.initBecomeForm,this.formData)},geTypeList(){return new Promise((e,t)=>{if(this.initBecomeType.length)return e();fetch("/core/enterprise/geTypeList").then(e=>e.json()).then(({code:o,data:r})=>{101===o&&(this.initBecomeType=r.filter(e=>(e.isDefault&&(this.initBecomeForm.type=e.id),1===e.hasExtra&&(this.hasExtra[e.id]=e.plainText),e)),e()),t()}).catch(e=>{t(e)})})},becomeOnSubmit(){this.$refs.becomeForm.validate(e=>{if(e){var t={};(0!==this.becomeForm.type||0===this.becomeForm.type&&!this.becomeForm.typeName)&&this.becomeType.find(e=>{if(e.id===this.becomeForm.type)return this.becomeForm.typeName=e.typeName,e}),Object.entries(this.becomeForm).forEach(([e,o])=>{""!==o&&(t[e]=o)}),this.loading=!0,fetch("/core/enterprise/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(e=>e.json()).then(({code:e})=>{this.loading=!1,101===e&&(this.$message({type:"success",message:"提交成功"}),this.$emit("submit",!0),this.closeBecomeDialog())}).catch(e=>{this.loading=!1,console.error("Error:",e)})}})},itemQuerySearch(e,t){if(e.length<2)return t([]);var o=new URLSearchParams;o.append("key",e),fetch("/vendor/autocompleteAddress?act=company",{method:"POST",body:o}).then(e=>e.json()).then(({status:e,data:o})=>{if(1===e){if(0===o.length)return t([]);var r=o.map(e=>({value:e}));return t(r)}return t([])}).catch(e=>(console.error("Error:",e),t([])))},closeBecomeDialog(){this.initData(),this.$refs.becomeForm&&this.$refs.becomeForm.clearValidate()}},template:'\n      <el-form ref="becomeForm" :model="becomeForm" :rules="becomeRules">\n        <el-form-item prop=\'name\'>\n          <el-input type="text" v-model="becomeForm.name" placeholder=\'请输入姓名\'></el-input>\n        </el-form-item>\n        <el-form-item prop=\'phone\'>\n          <el-input type="text" v-model="becomeForm.phone" placeholder=\'请输入电话号码\'></el-input>\n        </el-form-item>\n        <el-form-item prop=\'companyName\'>\n          <el-autocomplete style="width:100%" v-model="becomeForm.companyName" :fetch-suggestions="itemQuerySearch" :trigger-on-focus="false" placeholder="请输入公司名称"></el-autocomplete>\n        </el-form-item>\n        <el-form-item prop=\'type\'>\n          <el-radio-group v-model="becomeForm.type">\n            <el-radio v-for=\'item in becomeType\' :label="item.id" :key=\'item.id\'>{{item.typeName}}</el-radio>\n          </el-radio-group>\n        </el-form-item>\n        <el-form-item prop=\'dealerBrand\' v-if=\'becomeForm.type===22\'>\n          <el-input type="text" v-model="becomeForm.dealerBrand" :placeholder=\'hasExtra[22]\'></el-input>\n        </el-form-item>\n        <el-form-item prop=\'typeName\' v-if=\'becomeForm.type===0\'>\n          <el-input type="text" v-model="becomeForm.typeName" :placeholder=\'hasExtra[0]\'></el-input>\n        </el-form-item>\n        <el-form-item>\n          <el-button style="width:100%"  class="suzao-btn" type="primary" :disabled="loading" @click="becomeOnSubmit">\n            <slot>提交</slot>\n          </el-button>\n        </el-form-item>\n      </el-form>\n    '})});