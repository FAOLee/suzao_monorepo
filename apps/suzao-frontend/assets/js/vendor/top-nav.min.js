addEventListener("load",()=>{document.body.classList.add("suzao");const e={companyName:null,ename:null,enterprisePutStatus:null,exposure:0,ticketExamineStatus:null,userName:null},t=[{text:"资料审核中",icon:"/frontend/assets/layout/icon-settled-loading.png"},{text:"审核失败",icon:"/frontend/assets/layout/icon-settled-error.png"},{text:"审核成功(立即激活)",icon:"/frontend/assets/layout/icon-settled-ok.png"},{text:"申请成为供应商",icon:"/frontend/assets/layout/icon-settled.png"}],a={"/plastic/advanceSearchResult":"advsearch.result","/plastic/detail":"detail","/plastic/search":"list","/plastic/ai":"ai.search","/":"ai.search",other:"search.result"},s={"/plastic/ai":"ai.search","/":"ai.search",other:"enterprise.market.phone"};let i=null;const o=()=>{if(i){const e=document.getElementById("QRCode");e.innerHTML="",i=null}},n=(e,t,a)=>(i?i.makeCode(e):i=new QRCode("QRCode",{text:e,errorCorrectionLevel:"H",version:2,width:108,height:108}),i),r=new Vue({el:"#settledApp",data(){const a="/frontend/assets/layout/icon-member",s=".png?ver=20250220";return{byShare:[],shareVisible:!1,becomeTitle:t.at(-1),tips:{},unread:{message:0,suggestion:0,upOrderCount:0},vipStatus:"off",isEnterprise:!1,merchantForm:Object.assign({},e),ticketVisible:!1,memberVisible:!1,contentData:{title:"会员尊享以下免费权益",list:[{img:a+"1"+s,title:"物性表详情",tip:"免费无限查看"},{img:a+"2"+s,title:"物性表下载",tip:"免费无水印下载"},{img:a+"3"+s,title:"高级性能搜索",tip:"免费无限使用"},{img:a+"4"+s,title:"AI智能选材",tip:"免费无限使用"},{img:a+"5"+s,title:"对比功能/下载",tip:"支持无水印"}]},goodsList:[],payTab:[{icon:"/frontend/assets/page/pay/pay-wx.png",text:"微信支付",id:"wx_pay"},{icon:"/frontend/assets/page/pay/pay-zfb.png",text:"支付宝支付",id:"ali_pay"}],goodsId:"",payId:"wx_pay",wxTimer:null,QRCode:"",vipOrder:{orderNo:"",payReturn:""},isDefaultGoodsList:{},agree:!0}},created(){this.init()},computed:{unreadTotal(){return Number(this.unread.suggestion||0)+Number(this.unread.message||0)}},watch:{goodsId:{async handler(e,t){if(e)try{const{code:e,data:t}=await this.createVipOrder(this.goodsId,this.payId);101===e&&t?(this.vipOrder=t,this.goPay(t.payReturn,this.payId)):this.vipOrder={orderNo:"",payReturn:""}}catch(e){console.error(e),this.vipOrder={orderNo:"",payReturn:""}}}}},methods:{async init(){this.openShare(),_SZ_HAS_LOGIN?(this.computedUnreadTotal(),this.polymerizationInfo()):(localStorage.removeItem("advanceSearch"),localStorage.removeItem("unreadTotal"),localStorage.removeItem("isEnterprise"),localStorage.removeItem("ticketVisible"))},getItem(){const e=localStorage.getItem("unreadTotal");try{e&&(this.unread=JSON.parse(e))}catch(e){}finally{return this.unread}},async computedUnreadTotal(e){if(!e||"unreadTotal"===e.key){const t=e&&e.newValue||localStorage.getItem("unreadTotal");if(t&&(this.unread=JSON.parse(t)||{message:0,suggestion:0}),!this.unread.suggestion){window.member=await this.getMember();const{unread_msg:e,unread_suggestion:t}=window.member;this.unread.message=e,this.unread.suggestion=t,localStorage.setItem("unreadTotal",JSON.stringify(this.unread))}this.sendValue(this.unread)}},openDialog(e){location.href="/page/merchantRegistration"},requestData:()=>new Promise((e,t)=>{fetch("/core/adv2/getAdvertising?id=16&num=1&isGetTopAdvertising=false",{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(({code:a,data:s})=>{if(101===a)return s&&s.advertisingList&&s.advertisingList.length?(r.byShare=s.advertisingList.filter((e,t)=>(e.image=JSON.parse(e.image),e.video=JSON.parse(e.video),suzao.countHighlight(e.hash,"view"),e)),e(s)):e();t()}).catch(e=>{t(e)})}),openShare(){const e=suzao.getStorage("byShare");if(["PC","others"].includes(suzao.userAgent)&&!e){this.requestData().then(e=>{e&&(this.shareVisible=!0)}).catch(console.error);const e=suzao.forwardTimestamp(suzao.parseTime(new Date,"{y}-{m}-{d}"))+864e5;suzao.setStorage("byShare",1,e)}},getSuggestion:()=>new Promise((e,t)=>{fetch("/member/suggestion?type=list&size=0",{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(({status:a,errors:s,data:i})=>{if(a)return e(i);t(s.join(","))}).catch(e=>{t(e)})}),getMember:()=>new Promise((e,t)=>{fetch("/member",{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(e).catch(t)}),getGoodsList:()=>new Promise((e,t)=>{fetch("/core/vipTrade/getGoodsList",{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(e).catch(t)}),sendValue(e){const t=new CustomEvent("valueSent",{detail:e});window.dispatchEvent(t)},async polymerizationInfo(){try{const e=await fetch("/core/enterprise/polymerizationInfo"),{data:a}=await e.json();if(a)if(this.merchantForm=a,a.vipStatus&&(this.vipStatus=a.vipStatus),3===a.enterprisePutStatus)this.isEnterprise=!0,localStorage.setItem("isEnterprise",1);else if(localStorage.setItem("isEnterprise",""),2===a.enterprisePutStatus){this.becomeTitle=t[a.ticketExamineStatus];const e=localStorage.getItem("ticketVisible");2!==a.ticketExamineStatus||["/member","/page/merchantRegistration"].includes(location.pathname)||e||(this.ticketVisible=!0,localStorage.setItem("ticketVisible",1))}}catch(e){console.error(e)}},statisticsLog(){const e=document.querySelector("body");e.addEventListener("click",async e=>{const t=e.target,i=t.classList;if(i.contains("formatPhone")&&t.getAttribute("data-phone")){e.stopPropagation(),e.preventDefault(),t.textContent=t.getAttribute("data-phone"),t.removeAttribute("data-phone");let i=location.pathname;"/plastic/search"===i&&suzao.paramObj("key")&&(i="other");const o="pc.wxb."+(s[i]||s.other),n="pc.wxb."+(a[location.pathname]||a.other);let r=t.getAttribute("data-id");r||(r=suzao.paramObj("id"));const c=t.getAttribute("data-log-enterprise-id"),l=t.getAttribute("data-plastic-id");c&&l?suzao.clickCellphone({dataPlasticId:l,logEnterpriseShowId:c}):suzao.statisticsLog({event:o,pos:n,id:r})}try{let a="";if(i.contains("smallBusinessCollapse")?a=t:t.parentElement&&(t.parentElement.classList.contains("smallBusinessCollapse")?a=t.parentElement:t.parentElement.classList.contains("is-active")&&(a=t.parentElement.querySelector(".smallBusinessCollapse"))),a&&(e.stopPropagation(),e.preventDefault(),a.parentElement.classList.contains("is-active"))){const e=a.parentElement.parentElement.parentElement.querySelectorAll(".li"),t=[];if(Array.prototype.forEach.call(e,e=>{if(!e.classList.contains("smallBusinessCollapse")){const a=e.getAttribute("data-plastic-id"),s=e.getAttribute("data-enterprise-id");s&&t.push({dataPlasticId:a,enterpriseId:s,channel:2})}}),t.length){const{code:a,data:s}=await suzao.logEnterprise({list:t});101===a&&s.map((t,a)=>{if(t.id){const s=e[a].querySelector(".formatPhone");s?s.setAttribute("data-log-enterprise-id",t.id):e[a].setAttribute("data-log-enterprise-id",t.id)}})}}}catch(e){console.error(e)}})},clickUpload(e){this.uploadClick({buttonName:e})},uploadClick(e){fetch("/core/Click/upload",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})},tabGoodsList(e){this.goodsId=e.id,this.isDefaultGoodsList=e},async tabPayTab(e){if("ali_pay"===e.id)try{const{code:e,data:t}=await this.createVipOrder(this.goodsId,"ali_pay");101===e&&t?(this.vipOrder=t,this.goPay(t.payReturn,"ali_pay")):this.vipOrder={orderNo:"",payReturn:""}}catch(e){console.error(e),this.vipOrder={orderNo:"",payReturn:""}}},async openMemberInterest(){try{const{code:e,data:t,msg:a}=await this.getGoodsList();if(101===e&&t){this.goodsList=t;const e=t.find(e=>e.isDefault);return e?this.tabGoodsList(e):this.tabGoodsList(t[0]),void(this.memberVisible=!0)}this.$message.error(a)}catch(e){console.error(e)}},getOrderDetail(e){if(e)return new Promise((t,a)=>{fetch("/core/vipTrade/getVipOrderDetail?orderNo="+e,{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(t).catch(a)})},createVipOrder:(e,t)=>new Promise((a,s)=>{fetch("/core/vipTrade/createVipOrder",{headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"},method:"POST",body:JSON.stringify({goodsId:e,payType:t})}).then(e=>e.json()).then(a).catch(s)}),goPay(e,t){if(this.agree||this.$message({message:"请阅读并同意《平台信息服务协议》",type:"success"}),"wx_pay"===t&&(this.QRCode=n(e)),"ali_pay"===t){let t=document.getElementsByTagName("divform");t.length&&document.body.removeChild(t[0]);const a=document.createElement("divform");a.innerHTML=e,a.querySelector("form").setAttribute("target","_blank"),document.body.appendChild(a),document.querySelector("divform form").submit()}this.polling()},polling(){class e{constructor(){this.startPolling()}async startPolling(){r.wxTimer=setTimeout(async()=>{try{if(!1===r.memberVisible)return clearTimeout(r.wxTimer),void(r.wxTimer=null);const{code:e,data:t,msg:a}=await r.getOrderDetail(r.vipOrder.orderNo);if(101===e){if(t&&"success"===t.status)return clearTimeout(r.wxTimer),r.wxTimer=null,void location.reload();this.startPolling()}else 102===e?r.$message({type:"error",message:a}):r.$message({type:"error",message:"支付失败！"})}catch(e){r.$message({type:"error",message:"支付失败！"})}},2e3)}}r.wxTimer||new e,setTimeout(()=>{clearTimeout(r.wxTimer),r.wxTimer=null,r.goPay(r.vipOrder.payReturn,r.payId)},18e4)},initMemberDialog(){o(),clearTimeout(this.wxTimer),this.wxTimer=null,this.vipOrder={orderNo:"",payReturn:""},this.QRCode="",this.goodsId=""}},mounted(){this.statisticsLog()}}),c=/^[1][0-9]{10}$/,l=new Vue({el:"#loginApp",data:function(){var e=function(e,t,a){return t?c.test(t)?void a():a(new Error("请输入正确的手机号")):a(new Error("手机号不能为空"))},t=function(e,t,a){var s=/\d+/,i=/[A-Z]+/,o=/[a-z]+/,n=8;s.test(t)&&i.test(t)&&o.test(t)&&t.length>=n?a():a(new Error("密码至少8位数，同时包含大写字母、小写字母、数字"))},a=function(e,t,a){""===t?a(new Error("请再次输入密码")):t!==l.fillInfoForm.password?a(new Error("两次输入密码不一致!")):a()};return{loading:!1,activeTab:0,activeName:"login",byShare:[],loginForm:{username:"",password:""},loginRules:{username:[{required:!0,trigger:"blur",message:"账号不能为空"}],password:[{required:!0,trigger:"blur",message:"密码不能为空"}]},itemKey:Math.random(),phoneLoginForm:{cellphone:"",captcha:"123456",phone_captcha:""},phoneLoginRules:{captcha:[],phone_captcha:[{required:!0,message:"请输入短信验证码",trigger:"blur"},{pattern:/^[0-9]{6}$/,message:"请填写正确的短信验证码",trigger:"blur"}],cellphone:[{validator:e,trigger:"blur"}]},getPhoneCaptchaBtnStatus:!0,getPhoneCaptchaBtnTxt:"发送验证码",countDown:120,captchaTime:120,wxCodeSrc:"",wxLoading:!0,fillInfoForm:{name:"",password:"",password_rep:""},fillInfoRules:{password:[{validator:t,trigger:"blur"}],password_rep:[{validator:a,trigger:"blur"}]},base64:"data:image/png;base64,",paramUrl:suzao.paramObj(),wx:!1,wxTimer:null,loginVisible:!1,captcha:null,isCaptcha:!1,refer:""}},watch:{activeTab:{handler:function(e,t){1===e?this.getLoginQr():this.wxTimer&&clearTimeout(this.wxTimer),this.initAliyunCaptcha()},immediate:!0}},mounted(){},methods:{closeDialog(){},openDialog(e){document.getElementById("login")||(this.refer="",this.byShare.length||this.requestData(),"string"==typeof e&&(this.refer=e),this.loginVisible=!0)},handleClick:function(e){e&&e.name&&e.name!=this.activeName&&(this.activeName=e.name),this.initAliyunCaptcha(),this.$refs.tabs&&this.$refs.tabs.$el&&this.resetActivePosition(this.$refs.tabs.$el),e&&suzao.changeURLStatic({active:e.name})},resetActivePosition:function(e){},tabForm:function(e){this.activeTab=e},submitLogin:function(e){this.$refs[e].validate(function(t){t&&(l.loading=!0,fetch("/login/ajax",{method:"POST",body:suzao.parseFormData(l[e])}).then(e=>e.json()).then(e=>{1===e.status?l.goRefer():(l.$message({type:"error",message:e.errors.join("")}),l.loading=!1)}))})},async getYunDunCheck(e){const t=await fetch("/core/yunDun/checkV2",{method:"POST",body:e,headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"}});return await t.json()},async sendPhoneCaptcha(){const e=await fetch("/vendor/sendPhoneCaptcha",{method:"POST",body:suzao.parseFormData({cellphone:l.phoneLoginForm.cellphone,captcha:l.phoneLoginForm.captcha,type:"login"}),headers:{"X-Requested-With":"XMLHttpRequest"}});return await e.json()},isCaptchaOK:function(e){this.getPhoneCaptchaBtnStatus=!c.test(e)},endTiming:function(e){e&&clearTimeout(e),this.getPhoneCaptchaBtnTxt="发送验证码",this.captchaTime=this.countDown,this.isCaptchaOK(l.phoneLoginForm.cellphone)},submitPhoneForm:function(e){this.$refs.phoneLoginForm.validate(async function(e){if(!e)return!1;l.loading=!0;const t=await l.byPhoneCaptcha();1===t.status?(l.loading=!1,t.user.has_password?l.goRefer():l.tabForm(2)):(l.$message({type:"error",message:t.errors.join("")}),l.loading=!1)})},async byPhoneCaptcha(){const e=await fetch("/login/byPhoneCaptcha",{method:"POST",body:suzao.parseFormData({phone:l.phoneLoginForm.cellphone,phone_captcha:l.phoneLoginForm.phone_captcha})});return await e.json()},getLoginQr:function(){fetch("/vendor/getYqszLoginQr",{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(e=>{1===e.status?(l.wxLoading=!1,l.wxCodeSrc=l.base64+e.data.img,l.polling()):l.$message({type:"error",message:e.errors||e})})},setFillInfo:function(e){this.$refs[e].validate(function(t){if(!t)return!1;l.loading=!0,fetch("/member/fillInfo?scene=m_user",{method:"POST",body:JSON.stringify(l[e])}).then(e=>e.json()).then(e=>{1===e.status?l.goRefer():(l.$message({type:"error",message:e.errors.join("")}),l.loading=!1)})})},goRefer:function(){this.$message({type:"success",message:"登录成功"}),this.loginVisible=!1,suzao.isValidURL(this.refer)?window.location.href=this.refer:window.location.reload()},polling:function(){const e=function(){fetch("/vendor/checkGzhLogin").then(e=>e.json()).then(t=>{1===t.status?l.wxTimer=setTimeout(e,2e3):2===t.status?(clearTimeout(l.wxTimer),1===t.data.status?t.data.has_user?l.goRefer():(l.tabForm(0),l.handleClick({name:"reg"}),l.wx=!0):l.$message({type:"error",message:"扫码失败！"})):(clearTimeout(l.wxTimer),l.$message({type:"error",message:"扫码失败！"}))})};l.wxTimer=setTimeout(e,2e3),setTimeout(function(){clearTimeout(l.wxTimer)},6e4)},requestData:function(){fetch("/core/adv2/getAdvertising?id=100004&num=1&isGetTopAdvertising=false",{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(e=>{101===e.code&&e.data.advertisingList.length&&(l.byShare=e.data.advertisingList.filter((e,t)=>(e.image=JSON.parse(e.image),e.video=JSON.parse(e.video),e)))})},getInstance(e){this.captcha=e},async captchaVerifyCallback(e){const{code:t,msg:a}=await this.getYunDunCheck(e),s=101===t;return this.isCaptcha=s,{captchaResult:s,bizResult:s}},onBizResultCallback(e){this.$refs.phoneLoginForm.validateField(["cellphone"],async t=>{if(t||!this.isCaptcha||!e)return!1;this.isCaptcha=!1;try{const e=await this.sendPhoneCaptcha();1===e.status?(suzao.countdownTimer({startCallback:function(){l.getPhoneCaptchaBtnStatus=!0,l.getPhoneCaptchaBtnTxt=l.captchaTime+"s后重新发送"},callback:function(e){l.captchaTime--,l.getPhoneCaptchaBtnTxt=l.captchaTime+"s后重新发送"},endCallback:l.endTiming,endTime:l.countDown,timeInterval:1}),this.$message({type:"success",message:"发送成功"})):this.$message({type:"error",message:e.errors.join("")})}catch(e){console.error(e)}})},initAliyunCaptcha(){if("reg"!==this.activeName||0!==this.activeTab)return!1;window.initAliyunCaptcha({SceneId:"vs4yhveq",prefix:"f0n0ey",mode:"embed",element:"#captcha-element",button:"#captcha-img",captchaVerifyCallback:this.captchaVerifyCallback,onBizResultCallback:this.onBizResultCallback,getInstance:this.getInstance,slideStyle:{width:394,height:50},immediate:!1,language:"cn"})}}});window.openSettledDialog=function(e){window.suzao&&window.suzao.hasScrollbar&&window.suzao.hasScrollbar(),r&&r.openDialog&&(e&&void 0===e.target?r.openDialog(e):r.openDialog())},window.openLoginDialog=function(e){window.suzao&&window.suzao.hasScrollbar&&window.suzao.hasScrollbar(),l&&l.openDialog&&l.openDialog(e||"")},window.getItem=function(){if(r&&r.getItem)return r.getItem("getItem")},window.openMemberInterest=function(){window.suzao&&window.suzao.hasScrollbar&&window.suzao.hasScrollbar(),r&&r.openMemberInterest&&r.openMemberInterest()},addEventListener("click",function(e){const t=e.target;(e.target.classList.contains("open-member-interest")||t.closest(".open-member-interest"))&&window.openMemberInterest()})});