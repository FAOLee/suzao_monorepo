addEventListener("load",()=>{Vue.component("search-filter",{data:()=>({isActive:!1,fKey:"全部",bKey:null,fObj:[],bObj:[]}),props:["income","type","searchOpt","opener"],methods:{more(){this.isActive=!this.isActive},setFKey(e){this.fKey=e},setBKey(e){this.bKey=e.id,this.$parent.searchOpt=suzao.deepClone(this.$parent.searchOpt),this.$parent.searchOpt[this.type]=e.id,this.$parent.searchOpt.draw=1,this.$parent.searchOpt.cond=1,this.$parent.currentPage=1,this.$parent.getData(),this.$parent.selected[this.type]=e.name}},watch:{income:{handler(e){var t,s=["全部"],a=[];for(t=0;t<e.length;t++)if(null!==e[t].name){var i=checkCh(e[t].name).substring(0,1).toUpperCase(),r=i.charCodeAt(0);r<65||r>90?(e[t].key="#",s[1]="#"):(e[t].key=i,s[r]=i),a.push(e[t])}s=s.filter(function(e){return e&&e.trim()}),this.fObj=s,this.bObj=a,this.fKey="全部",this.bKey=null},immediate:!0},searchOpt(e){void 0===e[this.type]&&(this.bKey=null)}},template:'      <dd class=\'dd\'>        <div :class="{hidden: !isActive,div:true}">          <span v-for="(item, idx) in fObj" @click="setFKey(item)" :class="{active: item === fKey, span:true}">{{item}}</span>        </div>        <div :class="{one: !isActive,div:true}">          <span v-for="(item, idx) in bObj" @click="setBKey(item)" :class="{active: item.id === bKey, hidden: fKey !== \'全部\' && fKey !== item.key, span:true}" >{{item.name}}</span>        </div>        <el-button class="suzao-border-btn" size="mini" @click="more">{{isActive ? \'收起\' : \'更多\'}}</el-button>      </dd>'});const e={mfrs:[],species:[],enterprise:[]},t=()=>{const e=suzao.paramObj("key");if(!e)return"";try{return decodeURIComponent(e)||""}catch(e){return""}},s={mid:"制造商",cid:"种类",enterpriseId:"公司"},a=new Vue({el:"#merchant",data:{items:[],total:0,pageSize:20,currentPage:1,empty:0,suggest:[],search:suzao.deepClone(e),loading:!0,byShare:[],byKyeIds:[],searchOpt:{draw:1,cond:1},selected:{mid:"",cid:"",enterpriseId:""},selectedList:s,cb:null,params:suzao.paramObj(),searchKey:t(),channel:void 0,btnContent:{}},computed:{isFullScreen(){if(this.$refs.left&&this.$refs.footer)return Boolean(this.$refs.left.offsetHeight+this.$refs.footer.offsetHeight<window.innerHeight)},hasFilter(){return this.search.mfrs.length>1||this.search.species.length>1||this.search.enterprise.length>1||this.selected.mid||this.selected.cid||this.selected.enterpriseId}},methods:{init(){this.getButtonNavigation(),this.searchKey&&(this.searchOpt.key=this.searchKey),this.getData()},requestData(e,t,s){const a={id:e,num:t||1};this.byKyeIds.length&&this.currentPage>1&&(a.byKyeIds=this.byKyeIds.join(",")),void 0!==s&&(a.key=s),fetch(`/core/adv2/getAdvertising?${new URLSearchParams(a).toString()}`).then(e=>e.json()).then(e=>{101===e.code&&e.data&&e.data.advertisingList.length&&(this.byShare=e.data.advertisingList.map(e=>(e.image=JSON.parse(e.image),e.video=JSON.parse(e.video),e.link=this.toLink(e),this.countHighlight(e,"view"),e)),this.byKyeIds=e.data.byKyeIds)}).catch(e=>{console.error("Error:",e)})},countHighlight:(e,t)=>suzao.countHighlight(e.hash,t),async getData(){this.viewBox=[],this.loading=!0;let e="/core/merchant/recommend";const t=Object.assign({draw:this.searchOpt.draw,cond:this.searchOpt.cond,pageNum:this.currentPage,pageSize:this.pageSize},this.searchOpt);this.searchKey&&(t.key=this.searchKey),(this.searchOpt.mid||this.searchOpt.cid||this.searchOpt.enterpriseId||this.searchOpt.key||this.searchKey)&&(e="/core/merchant/searchV2"),fetch(`${e}?${new URLSearchParams(t).toString()}`).then(e=>e.json()).then(this.getSuccess).catch(e=>{console.error("Error:",e),this.loading=!1})},getSuccess(t){if(this.getByShare(this.searchKey),null!==this.cb&&(this.cb([]),this.cb=null),102===t.code)return this.$message({type:"error",message:t.msg,customClass:"z-index-max"}),void(this.loading=!1);1===t.status?(this.suggest=[],t.data.total<1?(this.resetSearchFilter(),this.empty=1,t.suggest&&t.suggest.length&&(this.suggest=t.suggest)):(this.empty=0,this.searchOpt.draw&&Object.entries(e).map(([e,s])=>{this.search[e]=t.search[e]||suzao.deepClone(s)}),this.items=t.data.items.map(this.processItem)),this.total=t.data.total,this.$nextTick(()=>{suzao.observer.call(suzao,this.channel)})):t.need_login?this.goLogin():0===t.status?this.empty=2:5007===t.code&&(this.$message({type:"error",message:t.msg,customClass:"z-index-max"}),window.openMemberInterest()),suzao.scrollTop(),this.loading=!1},processItem(e){const t={...e};if(e.szMarketV2){const s=[];Number(e.szMarketV2.rmb)&&s.push(`含税CNY${e.szMarketV2.rmb}/吨`),Number(e.szMarketV2.usd)&&s.push(`USD ${e.szMarketV2.usd}/吨`),t.unit_price=s.length?s.join(","):"价格询购",t.companyname=e.szMarketV2.companyname,t.cellphone=e.szMarketV2.cellphone,t.isExclusive=e.szMarketV2.isExclusive,t.enterpriseId=e.szMarketV2.enterpriseId,t.plasticFav="undefined"===e.szMarketV2.plasticFav?0:e.szMarketV2.plasticFav,t.enterpriseFav="undefined"===e.szMarketV2.enterpriseFav?0:e.szMarketV2.enterpriseFav,t.collapse=0}return t},resetSearchFilter(){this.search={mfrs:[],species:[],enterprise:[]},this.selected={mid:"",cid:"",enterpriseId:""}},autoComplete(e,t){e&&e.length<2||(this.cb=t,this.searchKey=e,fetch("/vendor/autoCompleteV3",{method:"POST",headers:{"Client-Type":2},body:suzao.parseFormData({key:e,scene:"merchant"})}).then(e=>e.json()).then(s=>{if(e!==a.resultKey&&s.data&&s.data.length){const e=s.data.map(e=>({value:e.title}));t(e)}else t([]),a.cb=null}).catch(e=>{console.error("Error:",e)}))},handleSearch(e){e&&(this.searchKey=e),this.currentPage=1,this.resetSearchFilter(),this.searchKey?this.params.key=this.searchKey:delete this.params.key,this.getData();const t=Object.keys(this.params).length?`?${suzao.objectToQueryString(this.params)}`:"";history.pushState({},"物性表 - 商城",location.pathname+t)},removeSelected(e){this.selected[e]="",this.searchOpt={draw:1,cond:1},this.getData()},handleSizeChange(e){this.pageSize=e,this.currentPage=1,this.getData()},handleCurrentChange(e){this.currentPage=e,this.getData()},getByShare(e){if(this.$refs.right){const t=parseInt((parseInt(getComputedStyle(this.$refs.right).height,10)+15)/198,10)||2;this.requestData(19,t,e)}},goLogin(e){if(!_SZ_HAS_LOGIN){if(window.openLoginDialog)return window.openLoginDialog("string"==typeof e?e:"");location.href="/login?refer="+location.pathname+encodeURIComponent(location.search)}},uploadClick:e=>fetch("/core/Click/upload",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}),toLink:e=>e.link?e.link+(e.link.includes("?")?"&":"?")+"hash="+e.hash:e.has_content?"page/highlightV2?id="+e.id:"",async favAdd(e){if(e.plasticFav&&e.enterpriseFav)return;const t=[];e.plasticFav||t.push(this.addFavorite(7,e.uuid,"plasticFav")),e.enterpriseFav||t.push(this.addFavorite(3,e.enterpriseId,"enterpriseFav"));try{let s=0;const a=await Promise.allSettled(t);a.forEach((t,a)=>{if("fulfilled"===t.status&&t.value){const{field:a,favId:i}=t.value;"plasticFav"===a&&(this.items=this.items.map(t=>(e.uuid===t.uuid&&(t[a]=i),t))),"enterpriseFav"===a&&(this.items=this.items.map(t=>(e.enterpriseId===t.enterpriseId&&(t.enterpriseFav=i),t))),s++}else"rejected"===t.status&&this.$message({type:"error",message:`收藏失败: ${t.reason}`,customClass:"z-index-max"})}),s===t.length&&this.$message({type:"success",message:"收藏成功",customClass:"z-index-max"})}catch(e){console.error("收藏操作发生错误:",e)}},async addFavorite(e,t,s){try{const a=await fetch("/member/favAdd",{method:"POST",headers:{"Client-Type":2},body:suzao.parseFormData({type:e,id:t})});if(!a.ok)throw new Error(`HTTP错误: ${a.status}`);const i=await a.json();if(i.status)return{field:s,favId:i.id};throw new Error(i.errors&&i.errors.join(",")||"收藏失败")}catch(e){throw console.error(`${s}收藏失败:`,e.message),e}},favDelete(e){fetch("/member/favDelete",{method:"POST",headers:{"Client-Type":2},body:suzao.parseFormData({ids:[e.enterpriseFav]})}).then(e=>e.json()).then(t=>{t.status?(this.items=this.items.map(t=>(e.enterpriseId===t.enterpriseId&&(t.enterpriseFav=0),t)),this.$message({type:"success",message:"取消收藏成功",customClass:"z-index-max"})):(this.$message({type:"error",message:"取消收藏失败",customClass:"z-index-max"}),console.error(t.errors.join(",")))}).catch(e=>{this.$message({type:"error",message:"取消收藏失败",customClass:"z-index-max"}),console.error("Error:",e)})},getButtonNavigation(){const e=new URLSearchParams({nameCodes:["pc_quoted_price","apply_for"]});fetch(`/core/merchant/getButtonNavigation?${e}`,{method:"GET",headers:{"Client-Type":2}}).then(e=>e.json()).then(({code:e,data:t})=>{101===e&&t.length&&(this.btnContent=t.filter(e=>e.status))}).catch(e=>{console.error("Error:",e)})},toMerchantRegistration(e){_SZ_HAS_LOGIN?(this.uploadClick({buttonName:"发布报价",type:30001}),window.open("/page/merchantRegistration")):window.open("/login?refer=/page/merchantRegistration")},toExclusive(e){const t=e.value||"400 869 1788";this.uploadClick({buttonName:"申请独家",type:30002}),this.$alert(`申请独家请联系客服: <a href="tel:${t}">${t}</a>`,"客服热线",{dangerouslyUseHTMLString:!0,lockScroll:!1,showConfirmButton:!1,showCancelButton:!0,cancelButtonText:"确定",cancelButtonClass:"suzao-btn"}).catch(e=>{})}},filters:{filter_formatPhone:e=>e.replace(/^(.*)(\d{3})(\d{4})(\d{4})$/g,"$1 $2 $3 $4")},created(){this.init()},mounted(){window.addEventListener("pushState",()=>{this.channel=suzao.getChannel()}),this.channel=suzao.getChannel()}})});