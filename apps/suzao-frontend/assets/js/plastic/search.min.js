addEventListener("load",()=>{var e=new Vue({el:"#plastic",data:{currency:{1:"未税RMB",2:"含税RMB",3:"USD",4:"HKD",5:"NTD",6:"EUR",7:"JPY"},items:[],total:0,pageSize:20,currentPage:1,compareList:JSON.parse(localStorage.getItem("compareList")||"[]"),compareCoordinate:{x:0,y:0},compareMax:5,outViewsShow:!1,outViewsTicket:"",activeFixed:"top",transitionLoading:!0,byShare:[],browser:suzao.browser,params:suzao.paramObj(),scrollHeight:0,eventSource:null,chatLoading:!1,isFloor:!0,paramsData:{},paddingTop:0,mfrsSpeciesList:[],selected:{mid:"",cid:""},searchOpt:{},initSearch:{mfrs:[],species:[]},search:{mfrs:[],species:[]},suggest:[],empty:0,market:[],market_uuid:{},enCompanyName:"",hide:!1,channel:void 0},watch:{},computed:{isFullScreen:function(){if(this.$refs.left&&this.$refs.footer)return Boolean(this.$refs.left.offsetHeight+this.$refs.footer.offsetHeight<window.innerHeight)}},methods:{init:function(e){e&&(this.currentPage=1),"mid"===e&&this.mfrsSpeciesListFilter(),this.params.queryContent?this.getEventSource(e):this.getMarketPlasticList(e)},toLink:function(e){return e.link?e.link+(e.link.includes("?")?"&":"?")+"hash="+e.hash:e.has_content?"page/highlightV2?id="+e.id:""},requestData:function(t,s,i){$axios({url:"/core/adv2/getAdvertising?id="+t+"&num="+(i||1)+"&key="+this.paramsData.key,method:"get"}).then(function(t){101===t.code?t.data.advertisingList.length&&(e[s]=t.data.advertisingList.map(function(e){return e.image=JSON.parse(e.image),e.video=JSON.parse(e.video),e})):e.$message.error(t.msg)})},getEventSource:function(e){function t(e){i.transitionLoading=!1;try{var t=JSON.parse(e.data);i.getSuccess(t),t.search&&Object.keys(i.search).forEach(function(e){t.search[e]&&t.search[e].length>=i.search[e].length&&(i.search[e]=t.search[e].map(function(e){return{label:e.name,value:String(e.id)}}))})}catch(e){}i.eventSource&&i.eventSource.close()}function s(e){console.log(e),i.$message.error(e.data),i.eventSource&&i.eventSource.close()}var i=this;try{this.paramsData.key=decodeURIComponent(this.params.queryContent)}catch(s){this.paramsData.key=this.params.queryContent}this.paramsData.convId=this.params.convId,this.paramsData.ansResultType=this.params.ansResultType,this.paramsData.ansId=this.params.ansId,this.params.uuid&&(this.paramsData.uuid=this.params.uuid),this.paramsData.pageNum=this.currentPage,this.paramsData.pageSize=this.pageSize,this.selected.mid?this.paramsData.mid=this.selected.mid:delete this.paramsData.mid,this.selected.cid?this.paramsData.cid=this.selected.cid:delete this.paramsData.cid;var a=new URLSearchParams(this.paramsData).toString();this.eventSource=new EventSource("/core/dm/botAPI/v2?"+a),this.transitionLoading=!0,this.eventSource.addEventListener("ES",t),this.eventSource.addEventListener("NL2SQL",t),this.eventSource.addEventListener("FUZZY_QUERY",t),this.eventSource.addEventListener("REPLACE02",t),this.eventSource.addEventListener("SYSTEM_ERROR",s),this.eventSource.addEventListener("error",s)},getMarketPlasticList:function(e){this.params.eid?this.paramsData.eid=this.params.eid:delete this.paramsData.eid,this.params.convId?this.paramsData.convId=this.params.convId:delete this.paramsData.convId,this.params.ansId?this.paramsData.ansId=this.params.ansId:delete this.paramsData.ansId,this.selected.mid?this.paramsData.mid=this.selected.mid||this.params.mid:delete this.paramsData.mid,this.selected.cid?this.paramsData.cid=this.selected.cid||this.params.cid:delete this.paramsData.cid,this.paramsData.pageNum=this.currentPage,this.paramsData.pageSize=this.pageSize;var t=new URLSearchParams(this.paramsData).toString(),s=this;$axios({url:"/core/dm/botAPI/getMarketPlasticList?"+t,method:"get"}).then(function(e){101===e.code?(s.getSuccess(e.data),e.data.data.mfrsSpeciesList&&0===s.mfrsSpeciesList.length&&(s.mfrsSpeciesList=e.data.data.mfrsSpeciesList,s.search.mfrs=s.mfrsSpeciesList.map(function(e){return{value:String(e.mfrsId),label:e.mfrsName}}),s.mfrsSpeciesListFilter())):s.$message.error(e.msg)})},getSuccess:function(e){if(1===e.status){if(this.suggest=[],e.data.total<1)this.empty=1,e.suggest&&e.suggest.length&&(this.suggest=e.suggest);else{this.empty=0;let s={},i={},a={};e.market_plastic&&(s=suzao.arrayToObjectByKey(e.market_plastic,"uuid")),e.recommendedSmallBusiness&&(i=suzao.arrayToObjectByKey(e.recommendedSmallBusiness,"uuid")),e.smallBusiness&&(a=suzao.arrayToObjectByKey(e.smallBusiness,"uuid")),this.items=e.data.items.map(e=>{let t={...e};return e.uuid in s?(t=Object.assign(e,s[e.uuid][0],{merchantType:"market_plastic"}),this.processItem(t)):e.uuid in i?(t=Object.assign(e,i[e.uuid][0],{merchantType:"recommendedSmallBusiness"}),e.uuid in a&&(t=Object.assign(t,{smallBusiness:a[e.uuid],merchantType:"smallBusiness"})),t):this.processItem(t)});var t="";1===e.data.type?t="代理商":2===e.data.type&&(t="生产厂家"),this.enCompanyName=t+": "+e.data.enCompanyName}this.total=e.data.total,this.$nextTick(()=>{suzao.observer.call(suzao,this.channel)})}else e.need_login?window.location.href="/login?refer="+location.pathname+location.search:0===e.status&&(this.empty=2);suzao.scrollTop(),this.transitionLoading=!1},mfrsSpeciesListFilter:function(){if(0!==this.mfrsSpeciesList.length){var e=this,t=e.search.mfrs.findIndex(function(t){return t.value===e.selected.mid});if(t>-1&&e.mfrsSpeciesList[t].speciesList){e.search.species=e.mfrsSpeciesList[t].speciesList.map(function(e){return{value:String(e.speciesId),label:e.speciesName}});const s=e.search.species.findIndex(t=>t.value===e.selected.cid);-1===s&&(e.selected.cid=e.search.species[0].value)}}},processItem:function(e){var t=[];return e.unit_price&&t.push(this.currency[e.currency]+" "+parseFloat(e.unit_price)+"/"+e.unit),e.unit_price_foreign&&t.push(this.currency[e.currency_foreign]+" "+parseFloat(e.unit_price_foreign)+"/"+e.unit),t.length?e.unit_price=t.join(","):e.unit_price="价格面议",e.certs?e.certs=e.certs.split(","):e.certs=[],e},removeCompare:function(e){void 0!==e?this.compareList.splice(e,1):this.compareList=[]},handleSizeChange:function(e){this.pageSize=e,this.currentPage=1,this.init(),setTimeout(suzao.scrollTop,300)},handleCurrentChange:function(e){this.currentPage=e,this.init(),setTimeout(suzao.scrollTop,300)},watchScroll:function(e){if(this.$refs.main&&this.$refs.thTitle&&this.$refs.footer){var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;t>this.$refs.main.getBoundingClientRect().top-this.$refs.thTitle.offsetHeight+this.paddingTop?window.innerHeight<this.$refs.footer.getBoundingClientRect().top?this.activeFixed="active":this.activeFixed="bottom":this.activeFixed="top"}else this.activeFixed="bottom"},backBottom:function(){this.isFloor&&this.$refs.chatContent&&(this.$refs.chatContent.scrollTop=this.$refs.chatContent.scrollHeight)},initCompare:function(){if(window.innerWidth<1720&&this.$refs.compareWarp){this.$refs.compareWarp.style.transform="translate(35vw, 20vh)",this.$refs.compareWarp.style.display="block";var e=getComputedStyle(this.$refs.compareWarp).transform;if("none"!==e){var t=e.match(/matrix.*\((.+)\)/)[1].split(", ");this.compareCoordinate={x:parseFloat(t[4]),y:parseFloat(t[5])}}this.$refs.compareWarp.style.display="none"}var s;this.$refs.compareList&&(this.paddingTop=parseFloat(getComputedStyle(this.$refs.compareList.$el).getPropertyValue("padding-top"))),window.addEventListener("scroll",this.watchScroll),setTimeout(suzao.scrollTop,300),window.addEventListener("resize",function(){clearTimeout(s),s=setTimeout(function(){suzao.scrollTop()},500)}),this.getByShare()},getByShare:function(){var e=2;this.$refs.right&&(e=this.$refs.chatContent?parseInt((parseInt(getComputedStyle(this.$refs.right).height,10)-450)/190,10):parseInt((parseInt(getComputedStyle(this.$refs.right).height,10)-50)/190,10)),this.requestData(100008,"byShare",e>4?4:e)},emailHtml:function(e){return"ie"===this.browser?e:'<a href="mailto:'+e+'?cc=service@17suzao.com">'+e+"</a>"},setHide:function(e){e.stopPropagation(),e.preventDefault(),this.hide=!0},toSubstitute(e){this.uploadClick({dataPlasticId:e.p_base_id,buttonName:"替代牌号"});const t=location.origin+`/plastic/search?uuid=${e.uuid}`;this.goLogin(t),_SZ_HAS_LOGIN&&e.uuid&&(location.href=t)},toQuotation(e){const t=`${location.origin}/page/merchantRegistration??uuid=${e.uuid}`;this.goLogin(t),_SZ_HAS_LOGIN&&e.uuid&&(console.log(t),window.open(t,"_blank"))},goLogin(e){if(!_SZ_HAS_LOGIN){if(window.openLoginDialog)return window.openLoginDialog("string"==typeof e?e:"");location.href="/login?refer="+location.pathname+encodeURIComponent(location.search)}},uploadClick:e=>fetch("/core/Click/upload",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})},filters:{filter_formatPhone:function(e,t){return suzao.formatPhone(e,t)}},created:function(){this.params.mid&&"undefined"!==this.params.mid&&(this.selected.mid=this.params.mid),this.params.cid&&"undefined"!==this.params.cid&&(this.selected.cid=this.params.cid),this.init()},mounted:function(){this.initCompare(),setTimeout(()=>{this.hide=!0},8e3),window.addEventListener("pushState",()=>{this.channel=suzao.getChannel()}),this.channel=suzao.getChannel()},destroyed:function(){window.removeEventListener("scroll",this.watchScroll)}})});